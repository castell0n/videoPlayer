class VideoPlayer{constructor(e={}){this.config={dimensions:{width:"100%",height:"100%",minWidth:300,minHeight:150,...e.dimensions||{}},controls:{showFullscreen:!0,showQuality:!0,showSubtitles:!1,showVolume:!0,showTime:!0,...e.controls||{}},videoQualities:e.videoQualities||[{name:"Source",src:"",poster:""}],subtitleOptions:e.subtitleOptions||[{code:"none",label:"Sin subtítulos"}],behavior:{autoplay:!1,loop:!1,defaultQuality:"lowest",showControlsOnInit:!0,hideControlsDelay:3e3,...e.behavior||{}}},this.elements={},this.mouseMoveTimeout=null,this.init()}formatTime(e){const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s<10?"0":""}${s}`}getLowestQuality(){const e=[...this.config.videoQualities].sort(((e,t)=>{const s=parseInt(e.name),i=parseInt(t.name);return(isNaN(s)?0:s)-(isNaN(i)?0:i)}));return e[e.length-1]}getQuality(e){switch(e){case"highest":return this.config.videoQualities[0];case"720p":return this.config.videoQualities.find((e=>e.name.includes("720p")))||this.getLowestQuality();default:return this.getLowestQuality()}}togglePlayPause(){this.elements.video.paused?this.elements.video.play().then((()=>{this.elements.playPauseBtn.classList.replace("fa-play","fa-pause"),this.showControls(),this.resetHideControlsTimeout()})).catch((e=>console.error("Error al reproducir:",e))):(this.elements.video.pause(),this.elements.playPauseBtn.classList.replace("fa-pause","fa-play"),this.showControls(),clearTimeout(this.mouseMoveTimeout))}toggleMute(){this.elements.video.muted=!this.elements.video.muted,this.elements.muteBtn.classList.toggle("fa-volume-up"),this.elements.muteBtn.classList.toggle("fa-volume-mute"),this.resetHideControlsTimeout()}skip(e){this.elements.video.currentTime=Math.max(0,Math.min(this.elements.video.duration,this.elements.video.currentTime+e)),this.resetHideControlsTimeout()}seek(e){if(!isNaN(this.elements.video.duration)){const t=this.elements.progressBar.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;this.elements.video.currentTime=s*this.elements.video.duration,this.resetHideControlsTimeout()}}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():this.elements.container.requestFullscreen().catch((e=>console.error("Error en pantalla completa:",e))),this.resetHideControlsTimeout()}showControls(){this.elements.controls.classList.add("show-controls"),this.elements.topBar.classList.add("show-controls")}hideControls(){this.elements.controls.classList.remove("show-controls"),this.elements.topBar.classList.remove("show-controls"),this.elements.settingsMenu.classList.remove("show-settings")}resetHideControlsTimeout(){clearTimeout(this.mouseMoveTimeout),this.mouseMoveTimeout=setTimeout((()=>this.hideControls()),this.config.behavior.hideControlsDelay)}showSettings(e){e.stopPropagation(),this.elements.settingsMenu.classList.toggle("show-settings"),this.showControls(),this.resetHideControlsTimeout()}hideSettings(){this.elements.settingsMenu.classList.remove("show-settings")}updateProgress(){if(!isNaN(this.elements.video.duration)){const e=this.elements.video.currentTime/this.elements.video.duration*100;this.elements.progress.style.width=`${e}%`,this.elements.currentTimeElem.textContent=this.formatTime(this.elements.video.currentTime)}}loadQualityOptions(){this.elements.qualityList.innerHTML="",this.config.videoQualities.forEach((e=>{const t=document.createElement("li");t.textContent=e.name,t.dataset.quality=e.name.toLowerCase(),t.addEventListener("click",(()=>this.changeQuality(e))),this.elements.qualityList.appendChild(t)}))}loadSubtitleOptions(){this.elements.subtitleList.innerHTML="",this.config.subtitleOptions.forEach((e=>{const t=document.createElement("li");t.textContent=e.label,t.dataset.subtitle=e.code,t.addEventListener("click",(()=>this.changeSubtitle(e))),this.elements.subtitleList.appendChild(t)}))}changeQuality(e){if(this.elements.video.src!==e.src){const t=!this.elements.video.paused,s=this.elements.video.currentTime;t&&(this.elements.video.dataset.shouldPlay="true"),this.elements.video.src=e.src,this.elements.video.poster=e.poster,this.elements.video.currentTime=s,this.elements.video.load(),this.hideSettings(),this.resetHideControlsTimeout()}}initSubtitles(){this.config.subtitleOptions.forEach((e=>{if("none"!==e.code&&e.src){const t=document.createElement("track");t.kind="subtitles",t.label=e.label,t.srclang=e.code,t.src=e.src,this.elements.video.appendChild(t)}}))}changeSubtitle(e){const t=this.elements.video.textTracks;for(let e=0;e<t.length;e++)t[e].mode="hidden";if("none"!==e.code){const s=Array.from(t).find((t=>t.language===e.code));s&&(s.mode="showing")}this.hideSettings(),this.resetHideControlsTimeout()}setupVideoEvents(){this.elements.video.addEventListener("loadedmetadata",(()=>{this.elements.durationElem.textContent=this.formatTime(this.elements.video.duration)})),this.elements.video.addEventListener("timeupdate",(()=>this.updateProgress())),this.elements.video.addEventListener("canplay",(()=>{"true"===this.elements.video.dataset.shouldPlay&&this.elements.video.play().then((()=>{this.elements.playPauseBtn.classList.replace("fa-play","fa-pause"),delete this.elements.video.dataset.shouldPlay})).catch((e=>console.error("Error al reanudar:",e)))}))}setupControls(){this.elements.playPauseBtn.addEventListener("click",(()=>this.togglePlayPause())),this.elements.video.addEventListener("click",(e=>{e.target===this.elements.video&&(this.togglePlayPause(),this.showControls(),this.resetHideControlsTimeout())})),this.elements.muteBtn.addEventListener("click",(()=>this.toggleMute())),this.elements.progressBar.addEventListener("click",(e=>this.seek(e))),this.elements.expandBtn.addEventListener("click",(()=>this.toggleFullscreen())),this.elements.backBtn.addEventListener("click",(()=>this.skip(-10))),this.elements.forwardBtn.addEventListener("click",(()=>this.skip(10))),this.elements.settingsBtn.addEventListener("click",(e=>this.showSettings(e))),document.addEventListener("click",(()=>this.hideSettings())),this.elements.settingsMenu.addEventListener("click",(e=>e.stopPropagation())),document.addEventListener("mousemove",(()=>{this.showControls(),this.resetHideControlsTimeout()}))}applyConfig(){if(this.config.dimensions){const e=this.config.dimensions;e.width&&(this.elements.container.style.width=e.width),e.height&&(this.elements.container.style.height=e.height),e.minWidth&&(this.elements.container.style.minWidth=`${e.minWidth}px`),e.minHeight&&(this.elements.container.style.minHeight=`${e.minHeight}px`)}this.elements.expandBtn.style.display=this.config.controls.showFullscreen?"inline-block":"none";const e=this.getQuality(this.config.behavior.defaultQuality);e&&(this.elements.video.src=e.src,this.elements.video.poster=e.poster,this.elements.video.addEventListener("error",(()=>{console.error("Error al cargar calidad por defecto, intentando con alternativa...");const t=this.getLowestQuality();t&&t!==e&&(this.elements.video.src=t.src,this.elements.video.poster=t.poster,this.elements.video.load())}))),this.config.behavior.autoplay&&this.elements.video.setAttribute("autoplay",""),this.config.behavior.loop&&this.elements.video.setAttribute("loop","")}createDOM(){const e=document.createElement("div");e.className="container";const t=document.createElement("div");t.className="top-bar";const s=document.createElement("div");s.className="video-wrapper";const i=document.getElementById("video")||document.createElement("video");i.className="video",i.id="video";const n=document.createElement("div");n.className="controls";const o=document.createElement("div");o.className="progress-container";const l=document.createElement("div");l.className="progress-bar",l.id="progress-bar";const a=document.createElement("div");a.className="progress",a.id="progress",l.appendChild(a),o.appendChild(l);const r=document.createElement("div");r.className="controls-left";const d=document.createElement("i");d.className="fas fa-play",d.id="play-pause";const c=document.createElement("i");c.className="fas fa-step-backward";const h=document.createElement("i");h.className="fas fa-step-forward";const m=document.createElement("i");m.className="fas fa-volume-up",m.id="mute";const u=document.createElement("div");u.className="time-display",u.innerHTML='<span id="current-time">0:00</span> / <span id="duration">0:00</span>',r.appendChild(c),r.appendChild(d),r.appendChild(h),r.appendChild(m),r.appendChild(u);const p=document.createElement("div");p.className="controls-right";const g=document.createElement("i");g.className="fas fa-cog";const v=document.createElement("i");v.className="fas fa-expand",p.appendChild(g),p.appendChild(v);const f=document.createElement("div");f.className="settings-menu",f.id="settings-menu";const y=document.createElement("ul");y.id="quality-list",y.innerHTML='<li class="settings-title">Calidad</li>';const C=document.createElement("ul");C.id="subtitle-list",C.innerHTML='<li class="settings-title">Subtítulos</li>',f.appendChild(y),f.appendChild(C),n.appendChild(o),n.appendChild(r),n.appendChild(p),n.appendChild(f),s.appendChild(i),e.appendChild(t),e.appendChild(s),e.appendChild(n),i.parentElement?(i.parentElement.replaceChild(e,i),e.querySelector(".video-wrapper").appendChild(i)):document.body.appendChild(e),this.elements={video:i,playPauseBtn:d,muteBtn:m,progress:a,progressBar:l,currentTimeElem:document.getElementById("current-time"),durationElem:document.getElementById("duration"),settingsBtn:g,settingsMenu:f,qualityList:y,subtitleList:C,expandBtn:v,backBtn:c,forwardBtn:h,controls:n,topBar:t,container:e}}init(){this.createDOM(),this.applyConfig(),this.setupVideoEvents(),this.setupControls(),this.loadQualityOptions(),this.loadSubtitleOptions(),this.initSubtitles(),this.config.behavior.showControlsOnInit&&this.showControls()}}window.VideoPlayer=VideoPlayer;